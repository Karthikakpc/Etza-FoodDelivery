{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ETZA | Your Cart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/cart.css' %}">
</head>
<body>

<section class="cart-hero">
    <div class="overlay"></div>

    <!-- TOP BAR -->
    <div class="top-bar">
        <h2>Hello {{ username }} ðŸ‘‹</h2>
        <a href="{% url 'checkout' username %}" class="checkout-btn">
            Proceed to Checkout
        </a>
    </div>

    <div class="container">
        <h3 class="page-title">Your Cart</h3>

        <div class="cart-layout">

            <!-- CART ITEMS -->
            <div class="cart-items">
                {% for item in itemList %}
                <div class="cart-card">

                    <div class="image-box">
                        <img src="{{ item.picture }}" alt="{{ item.name }}">
                    </div>

                    <div class="item-info">
                        <h4>{{ item.name }}</h4>
                        <p>{{ item.description }}</p>
                    </div>

                    <div class="item-price">
                        â‚¹{{ item.price }}
                    </div>

                    <form method="POST"
                          action="{% url 'remove_from_cart' item.id username %}"
                          class="delete-form">
                        {% csrf_token %}
                        <button type="button" class="delete-btn">
                            âœ•
                        </button>
                    </form>

                </div>
                {% empty %}
                <p>Your cart is empty.</p>
                {% endfor %}
            </div>

            <!-- SUMMARY -->
            <div class="summary-card">
                <h4>Order Summary</h4>

                <div class="summary-row">
                    <span>Total</span>
                    <strong>â‚¹{{ total_price }}</strong>
                </div>

                <a href="{% url 'checkout' username %}" class="checkout-btn full">
                    Checkout
                </a>
            </div>

        </div>
    </div>
</section>

<!-- DELETE CONFIRM MODAL -->
<div id="deleteModal" class="delete-modal">
    <div class="delete-modal-content">
        <h3>Remove item?</h3>
        <p>Are you sure you want to remove this item from your cart?</p>

        <div class="modal-actions">
            <button class="cancel-btn" type="button">Cancel</button>
            <button class="confirm-btn" type="button">Remove</button>
        </div>
    </div>
</div>

<script>
let deleteForm = null;

document.addEventListener("DOMContentLoaded", () => {

    document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            deleteForm = btn.closest("form");
            document.getElementById("deleteModal").classList.add("active");
            document.body.style.overflow = "hidden";
        });
    });

    document.querySelector(".cancel-btn").addEventListener("click", closeModal);
    document.querySelector(".delete-modal").addEventListener("click", closeModal);

    document.querySelector(".delete-modal-content")
        .addEventListener("click", e => e.stopPropagation());

    document.querySelector(".confirm-btn").addEventListener("click", () => {
        if (deleteForm) {
            deleteForm.submit();
        }
    });
});

function closeModal() {
    document.getElementById("deleteModal").classList.remove("active");
    document.body.style.overflow = "";
    deleteForm = null;
}
</script>

</body>
</html>
